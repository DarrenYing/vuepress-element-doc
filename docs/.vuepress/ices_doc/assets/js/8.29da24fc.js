(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{581:function(t,a,s){"use strict";s.r(a);var n=s(38),r=Object(n.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"常见问题记录和解答"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#常见问题记录和解答"}},[t._v("#")]),t._v(" 常见问题记录和解答")]),t._v(" "),s("h2",{attrs:{id:"_1-单机多卡训练时-多卡使用率不均衡"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-单机多卡训练时-多卡使用率不均衡"}},[t._v("#")]),t._v(" 1.单机多卡训练时，多卡使用率不均衡")]),t._v(" "),s("blockquote",[s("p",[t._v("可能是由于num_workers过小，CPU读取数据慢，读的数据只够一张卡训练，可以尝试调大num_workers")]),t._v(" "),s("p",[t._v("推荐将num_workers数量设置为GPU数量的4倍，开启pin_memory")])]),t._v(" "),s("h2",{attrs:{id:"_2-数据集的随机数种子固定"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-数据集的随机数种子固定"}},[t._v("#")]),t._v(" 2.数据集的随机数种子固定")]),t._v(" "),s("blockquote",[s("p",[t._v("在每个epoch重置data_sampler的随机数种子，"),s("code",[t._v("train_loader.sampler.set_epoch(epoch)")])])]),t._v(" "),s("h2",{attrs:{id:"_3-多卡控制台输出信息重复"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-多卡控制台输出信息重复"}},[t._v("#")]),t._v(" 3.多卡控制台输出信息重复")]),t._v(" "),s("blockquote",[s("p",[t._v("推荐使用logging代替print进行信息打印，并给不同进程设置不同的输出级别，只在0号进程（主进程）保留全部输出。")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" logging\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 给主要进程（rank=0）设置低输出等级，给其他进程设置高输出等级。")]),t._v("\nlogging"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("basicConfig"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("level"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("logging"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("INFO "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" rank "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" logging"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("WARN"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 普通log，只会打印一次。")]),t._v("\nlogging"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("info"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"This is an ordinary log."')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 危险的warning、error，无论在哪个进程，都会被打印出来，从而方便debug。")]),t._v("\nlogging"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("error"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"This is a fatal log!"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])])]),t._v(" "),s("h2",{attrs:{id:"_4-多卡的训练精度不如单卡"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-多卡的训练精度不如单卡"}},[t._v("#")]),t._v(" 4.多卡的训练精度不如单卡")]),t._v(" "),s("blockquote",[s("p",[t._v("如果单机卡数为n，需要修改batch_size为单卡时的1/n，如果增大batch_size,需要将learning rate也相应增大")]),t._v(" "),s("p",[t._v("如果model中有BatchNorm层，推荐开启SyncBN")]),t._v(" "),s("p",[s("code",[t._v("model = torch.nn.SyncBatchNorm.convert_sync_batchnorm(model).to(device)")])])])])}),[],!1,null,null,null);a.default=r.exports}}]);